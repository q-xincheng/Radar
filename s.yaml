# ==============================================================================
# Serverless Devs Configuration for Industry Radar
# ==============================================================================
# This file defines the deployment configuration for Alibaba Cloud Function Compute
# 
# Deployment commands:
#   s config add          # Configure Alibaba Cloud credentials (first time only)
#   s deploy              # Deploy function and triggers
#   s deploy function     # Deploy function only (faster updates)
#   s invoke              # Test invoke the function
#   s logs -t             # View real-time logs
#   s remove              # Remove deployed resources
#
# For detailed instructions, see README.md and doc/阿里云 FC 部署操作指南.md
# ==============================================================================

edition: 1.0.0
name: industry-radar-app
access: default

services:
  industry-radar-service:
    component: devsapp/fc
    props:
      region: cn-shanghai
      service:
        name: industry-radar-service
        description: Industry research monitoring service
        internetAccess: true
      function:
        name: industry-radar-func
        description: Industry Radar - Automated monitoring and analysis
        runtime: python3.10
        codeUri: ./
        handler: codes/trigger_layer.handler
        memorySize: 512
        timeout: 300
        environmentVariables:
          # Storage backend configuration
          STORAGE_BACKEND: oss
          
          # OSS Configuration (verified in cn-shanghai with radar-test bucket)
          OSS_BUCKET: radar-test
          OSS_ENDPOINT: https://oss-cn-shanghai.aliyuncs.com
          OSS_PREFIX: radar/
          
          # Data and database paths (use /tmp for FC environment)
          DATA_DIR: /tmp/data
          DB_PATH: /tmp/data/radar.db
          
          # LLM Configuration (optional - will use defaults if not set)
          LLM_MODEL: deepseek-ai/DeepSeek-V3
          LLM_BASE_URL: https://api.siliconflow.cn/v1
          LLM_MAX_RETRIES: "3"
          
          # Sensitive keys should be set via FC console or using ${env(VAR_NAME)} syntax
          # Required API keys (uncomment and configure via environment or FC console):
          # SILICONFLOW_API_KEY: ${env(SILICONFLOW_API_KEY)}
          # 
          # Optional: If not using RAM role for OSS access, configure:
          # ALIBABA_CLOUD_ACCESS_KEY_ID: ${env(ALIBABA_CLOUD_ACCESS_KEY_ID)}
          # ALIBABA_CLOUD_ACCESS_KEY_SECRET: ${env(ALIBABA_CLOUD_ACCESS_KEY_SECRET)}
          # 
          # DO NOT hardcode sensitive API keys directly in this file
      triggers:
        - name: timer-trigger
          type: timer
          config:
            cronExpression: '0 0 */6 * * *'
            enable: true
            payload: '{"keyword": "半导体"}'