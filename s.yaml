services:
  name: industry-radar
  component: fc
  props:
    region: cn-hangzhou
    service:
      name: industry-radar-service
      description: 行研雷达服务
    function:
      name: industry-radar-func
      description: 行研雷达函数
      runtime: python3.9
      handler: codes/trigger_layer.handler
      memorySize: 512
      timeout: 60
      environmentVariables:
        # LLM API 配置（必填）
        SILICONFLOW_API_KEY: ${env(SILICONFLOW_API_KEY)}
        LLM_MODEL: ${env(LLM_MODEL, 'deepseek-ai/DeepSeek-V3')}
        LLM_BASE_URL: ${env(LLM_BASE_URL, 'https://api.siliconflow.cn/v1')}
        LLM_TEMPERATURE: ${env(LLM_TEMPERATURE, '0.1')}
        LLM_MAX_RETRIES: ${env(LLM_MAX_RETRIES, '3')}
        # 默认关键词
        DEFAULT_KEYWORD: ${env(DEFAULT_KEYWORD, '半导体')}
        # 数据存储目录
        DATA_DIR: ${env(DATA_DIR, 'data')}
        # 阿里云 OSS 配置（可选，用于云端存储）
        # OSS_ACCESS_KEY_ID: ${env(OSS_ACCESS_KEY_ID)}
        # OSS_ACCESS_KEY_SECRET: ${env(OSS_ACCESS_KEY_SECRET)}
        # OSS_ENDPOINT: ${env(OSS_ENDPOINT)}
        # OSS_BUCKET: ${env(OSS_BUCKET)}
        # OSS_PREFIX: ${env(OSS_PREFIX, 'radar/')}
    triggers:
      - name: timer-trigger
        type: timer
        config:
          cronExpression: '0 0 */6 * * *'  # 每6小时执行一次
          payload: '{"keyword": "半导体"}'
          enable: true

# 使用说明：
# 1. 安装 Serverless Devs CLI (s)
#    npm install -g @serverless-devs/s
# 
# 2. 配置阿里云账号
#    s config add
# 
# 3. 设置环境变量（在本地 .env 文件或系统环境变量中）
#    export SILICONFLOW_API_KEY="your-api-key-here"
# 
# 4. 部署到阿里云
#    s deploy
# 
# 5. 本地调试
#    s local invoke -e '{"keyword": "半导体"}'
# 
# 备注：
# - 如果你的团队使用不同的 region 或 runtime，请修改相应字段
# - memorySize 和 timeout 可根据实际需要调整
# - 触发器的 cronExpression 格式: 秒 分 时 日 月 周
#   示例: 
#     '0 0 */6 * * *' - 每6小时执行一次
#     '0 0 9 * * *'   - 每天上午9点执行
#     '0 */30 * * * *' - 每30分钟执行一次
